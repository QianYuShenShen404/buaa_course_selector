# 快速开始

<cite>
**本文档引用的文件**
- [README.md](file://README.md)
- [requirements.txt](file://requirements.txt)
- [config_simple.json](file://config_simple.json)
- [main_v2_hybrid.py](file://main_v2_hybrid.py)
- [src/hybrid_course_selector.py](file://src/hybrid_course_selector.py)
- [src/playwright_authenticator.py](file://src/playwright_authenticator.py)
- [src/http_course_executor.py](file://src/http_course_executor.py)
</cite>

## 目录
1. [项目简介](#项目简介)
2. [环境准备](#环境准备)
3. [安装步骤](#安装步骤)
4. [配置设置](#配置设置)
5. [获取课程信息](#获取课程信息)
6. [运行选课](#运行选课)
7. [端到端完整示例](#端到端完整示例)
8. [故障排除](#故障排除)
9. [注意事项](#注意事项)
10. [总结](#总结)

## 项目简介

本项目是专为北京航空航天大学学生设计的选课系统自动化工具，采用**混合架构**设计。该工具结合了Playwright自动登录的可靠性和HTTP直接请求的高效性，实现了最佳的选课体验。

### 核心优势

- **✅ 成功率超高**：95%+的选课成功率，经过大量测试验证
- **⚡ 速度极快**：毫秒级HTTP响应，抢课快人一步
- **🔐 配置简单**：只需用户名密码和课程信息，无需手动获取Token
- **🎯 智能重试**：双重重试机制，认证失败和网络异常都会自动重试
- **📊 全程可控**：详细日志记录，执行过程透明

## 环境准备

### Python版本要求

- **Python**: 3.8 或更高版本
- **操作系统**: Windows 10/11（推荐）
- **网络**: 稳定的网络连接（建议校园网）

### Playwright浏览器要求

本项目使用Playwright进行自动登录认证，需要安装Chromium浏览器驱动。

## 安装步骤

### 第一步：下载项目

```bash
# 从GitHub克隆项目
git clone https://github.com/your-username/buaa_course_selection_beta_dev.git
cd buaa_course_selection_beta_dev

# 或者下载ZIP文件并解压到此目录
```

### 第二步：安装Python依赖

```bash
pip install -r requirements.txt
```

### 第三步：安装Playwright浏览器

```bash
playwright install chromium
```

**重要提示**：首次运行时Playwright会自动下载浏览器，这可能需要几分钟时间。请确保网络连接稳定。

## 配置设置

### 编辑配置文件

复制并编辑 `config_simple.json` 文件：

```json
{
  "user_credentials": {
    "username": "你的学号",
    "password": "你的密码"
  },
  "course_info": {
    "course_id": "课程ID",
    "batch_id": "选课批次ID",
    "course_name": "课程名称"
  },
  "browser_config": {
    "headless": false,
    "timeout": 30000,
    "slow_mo": 1000,
    "viewport_width": 1280,
    "viewport_height": 720
  },
  "logging": {
    "level": "INFO",
    "file_path": "logs/hybrid_course_selector.log",
    "max_size_mb": 100,
    "backup_count": 5,
    "format": "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  }
}
```

### 配置项详解

| 配置项 | 说明 | 示例值 |
|--------|------|--------|
| `username` | 你的学号 | "2023123456" |
| `password` | 你的密码 | "your_password" |
| `course_id` | 课程ID | "202520261B060032020001" |
| `batch_id` | 选课批次ID | "d6d090c4364342bc94de17a22eaf7068" |
| `course_name` | 课程名称 | "计算机工程中最优化的方法" |
| `headless` | 是否隐藏浏览器窗口 | false |
| `timeout` | 超时时间（毫秒） | 30000 |

**节来源**
- [config_simple.json](file://config_simple.json#L1-L26)

## 获取课程信息

### 手动登录选课系统

1. 打开浏览器访问：https://byxk.buaa.edu.cn/
2. 使用你的学号和密码登录
3. 进入选课页面，找到你想选的课程

### 获取课程ID和批次ID

1. **打开浏览器开发者工具**（F12）
2. **点击课程的"选课"按钮**
3. **在Network标签页中查看请求**
4. **从请求中复制以下信息**：
   - `clazzId`：课程ID
   - `batchid`：选课批次ID

### 获取secretVal（可选）

当系统无法自动获取secretVal时，可以使用独立的提取工具：

```bash
cd tools
python quick_secret_extractor.py
```

**节来源**
- [README.md](file://README.md#L80-L120)

## 运行选课

### 基础运行

```bash
# 基础运行
python main_v2_hybrid.py
```

### 测试配置

```bash
# 测试配置和网络连接
python main_v2_hybrid.py --test
```

### 调试模式

```bash
# 调试模式（显示浏览器窗口）
python main_v2_hybrid.py --debug
```

### 使用命令行参数

```bash
# 使用命令行参数覆盖配置
python main_v2_hybrid.py --username 你的学号 --course-id 课程ID
```

### 命令行选项详解

| 参数 | 说明 | 示例 |
|------|------|------|
| `--config` | 指定配置文件路径 | `--config my_config.json` |
| `--test` | 测试配置和网络连接 | |
| `--username` | 临时覆盖用户名 | `--username 2023123456` |
| `--password` | 临时覆盖密码 | `--password your_pass` |
| `--course-id` | 临时覆盖课程ID | `--course-id 123456` |
| `--batch-id` | 临时覆盖批次ID | `--batch-id abcdef` |
| `--help-config` | 显示配置帮助信息 | |
| `--version` | 显示程序版本信息 | |

**节来源**
- [main_v2_hybrid.py](file://main_v2_hybrid.py#L40-L120)

## 端到端完整示例

以下是完整的操作流程示例：

### 1. 准备工作

```bash
# 克隆项目
git clone https://github.com/your-username/buaa_course_selection_beta_dev.git
cd buaa_course_selection_beta_dev

# 安装依赖
pip install -r requirements.txt
playwright install chromium
```

### 2. 配置文件设置

编辑 `config_simple.json`：

```json
{
  "user_credentials": {
    "username": "2023123456",
    "password": "your_password"
  },
  "course_info": {
    "course_id": "202520261B060032020001",
    "batch_id": "d6d090c4364342bc94de17a22eaf7068",
    "course_name": "计算机工程中最优化的方法"
  },
  "browser_config": {
    "headless": false,
    "timeout": 30000
  }
}
```

### 3. 测试配置

```bash
# 测试配置是否正确
python main_v2_hybrid.py --test
```

### 4. 执行选课

```bash
# 开始选课
python main_v2_hybrid.py
```

### 5. 查看结果

选课完成后，程序会显示选课结果。成功时会显示：

```
🎉 选课成功
📚 课程: 计算机工程中最优化的方法
📖 课程ID: 202520261B060032020001
⏱️  总用时: 15.3s (认证: 12.1s + 选课: 3.2s)
🔄 重试次数: 认证1次, 选课0次
```

失败时会显示错误原因和建议：

```
💔 选课失败
❌ 原因: 课程已满
⏱️  总用时: 10.5s
🔐 认证错误: 无
🚀 选课错误: 课程已满，无法选课
```

**节来源**
- [main_v2_hybrid.py](file://main_v2_hybrid.py#L200-L300)

## 故障排除

### 常见问题及解决方案

#### 1. 配置文件不存在

**问题**：提示"配置文件不存在"
**解决方案**：
- 确保 `config_simple.json` 文件在项目根目录
- 复制模板文件并填写必要信息
- 运行 `python main_v2_hybrid.py --help-config` 查看配置帮助

#### 2. 登录失败

**问题**：认证过程中出现错误
**解决方案**：
- 检查用户名密码是否正确
- 确认账号状态正常
- 查看日志文件：`logs/hybrid_course_selector.log`

#### 3. 选课失败

**问题**：选课请求失败
**解决方案**：
1. 确认选课时间是否开放
2. 检查课程ID和批次ID是否正确
3. 查看日志文件获取详细错误信息

#### 4. secretVal获取失败

**问题**：无法自动获取secretVal
**解决方案**：
```bash
cd tools
python quick_secret_extractor.py
```

### 调试技巧

1. **查看详细日志**：
```bash
type logs\hybrid_course_selector.log
```

2. **测试网络连接**：
```bash
python main_v2_hybrid.py --test
```

3. **显示浏览器窗口**（调试认证问题）：
在 `config_simple.json` 中设置 `"headless": false`

**节来源**
- [README.md](file://README.md#L180-L220)

## 注意事项

### 首次运行注意事项

1. **Playwright自动下载**：首次运行时Playwright会自动下载浏览器，这可能需要几分钟时间
2. **网络稳定性**：建议使用校园网以获得最佳性能
3. **配置文件格式**：确保JSON格式正确，注意逗号、引号等语法
4. **日志文件位置**：日志文件位于 `logs/hybrid_course_selector.log`

### 安全提示

1. **隐私保护**：本工具不会收集或上传任何用户信息
2. **密码安全**：不要共享包含密码的配置文件
3. **使用规范**：请遵守学校选课规定，合理使用
4. **风险提示**：使用自动化工具可能违反使用条款，请自行承担风险

### 性能优化

1. **运行时间**：建议在选课开始前5分钟运行程序
2. **网络环境**：使用稳定的网络环境（校园网推荐）
3. **避免并发**：避免同时运行多个选课程序实例
4. **定期备份**：建议备份重要的配置文件

**节来源**
- [README.md](file://README.md#L220-L260)

## 总结

本快速开始指南涵盖了从环境准备到成功选课的完整流程。通过遵循这些步骤，你可以：

1. **成功部署**：在本地环境中部署并运行选课工具
2. **正确配置**：填写必要的配置信息，包括学号、密码和课程信息
3. **理解流程**：掌握混合架构的工作原理和优势
4. **解决问题**：学会排查常见问题和故障排除
5. **安全使用**：了解使用注意事项和安全提示

记住，虽然本工具提供了高成功率的选课解决方案，但仍需遵守学校的选课政策和时间限制。祝你选课顺利！

**节来源**
- [README.md](file://README.md#L1-L50)
- [main_v2_hybrid.py](file://main_v2_hybrid.py#L1-L50)